<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>San Martín Hockey - Recibos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #003366; --secondary: #00509d; }
        body { background: #eef2f7; font-family: 'Segoe UI', sans-serif; }
        .navbar { background: var(--primary) !important; padding: 10px 0; }
        .logo-club { height: 60px; filter: drop-shadow(0 0 5px rgba(255,255,255,0.5)); }
        .card { border: none; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .card-header { background: var(--primary); color: white; border-radius: 15px 15px 0 0 !important; font-weight: bold; }
        .btn-primary { background: var(--primary); border: none; }
        .btn-success { background: #28a745; border: none; font-weight: bold; }
        #areaRecibo { display: none; background: white; padding: 40px; }
        @media print { body * { visibility: hidden; } #areaRecibo, #areaRecibo * { visibility: visible; } #areaRecibo { position: absolute; left: 0; top: 0; width: 100%; } }
    </style>
</head>
<body>

<nav class="navbar navbar-dark mb-4">
    <div class="container d-flex justify-content-center align-items-center">
        <img src="logo.png" alt="Logo San Martin" class="logo-club me-3">
        <span class="navbar-brand mb-0 h1 text-uppercase">San Martín Hockey</span>
    </div>
</nav>

<div id="pantalla-login" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--primary); z-index:10000; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px;">
    <img src="logo.png" alt="Logo" style="height: 120px; margin-bottom: 20px;">
    <div class="card p-4 w-100" style="max-width:350px;">
        <h4 class="text-center mb-4">Ingreso 2026</h4>
        <input type="password" id="input-clave" class="form-control mb-3 text-center" placeholder="Clave">
        <button class="btn btn-primary w-100" onclick="verificarClave()">INGRESAR</button>
        <p id="error-msg" class="text-danger mt-2 text-center" style="display:none;">Clave incorrecta</p>
    </div>
</div>

<div class="container mb-5">
    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header py-3 text-center">GENERAR NUEVO RECIBO</div>
                <div class="card-body p-4">
                    <form id="formCobro">
                        <div class="mb-3 position-relative">
                            <label class="form-label fw-bold">Nombre del Socio</label>
                            <input type="text" id="nombre" class="form-control form-control-lg" autocomplete="off" required placeholder="Empiece a escribir para buscar...">
                            <ul id="listaSugerencias" class="list-group d-none shadow" style="position:absolute; z-index:1000; width:100%;"></ul>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Categoría</label>
                                <input type="text" id="categoria" class="form-control bg-light" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Mes</label>
                                <select id="mes" class="form-select"></select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Concepto</label>
                            <input type="text" id="concepto" class="form-control" value="CUOTA SOCIAL">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Importe $</label>
                                <input type="number" id="total" class="form-control form-control-lg text-success fw-bold" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Forma de Pago</label>
                                <select id="pago" class="form-select">
                                    <option>EFECTIVO</option>
                                    <option>TRANSFERENCIA</option>
                                    <option>TARJETA</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success btn-lg w-100 mt-3 shadow">
                            <i class="fa fa-print me-2"></i>IMPRIMIR COMPROBANTE
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card p-3 mb-3">
                <button class="btn btn-primary w-100 mb-2 py-3" data-bs-toggle="modal" data-bs-target="#modalSocio">
                    <i class="fa fa-user-plus me-2"></i>NUEVO SOCIO
                </button>
                <button class="btn btn-outline-dark w-100" onclick="exportarExcel()">
                    <i class="fa fa-file-excel me-2"></i>REPORTE EXCEL
                </button>
            </div>
            <div class="card p-3 shadow-sm">
                <h6 class="border-bottom pb-2">Últimos movimientos</h6>
                <div id="tablaHistorialBody" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalSocio" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="fw-bold">Registrar Socio</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Nombre Completo</label>
                    <input type="text" id="nuevoSocioNombre" class="form-control" placeholder="Ej: JUAN PEREZ">
                </div>
                <div class="mb-3">
                    <label class="form-label">Categoría</label>
                    <select id="nuevoSocioCat" class="form-select">
                        <option value="PRIMERA">PRIMERA</option>
                        <option value="JUVENILES">JUVENILES</option>
                        <option value="INFANTILES">INFANTILES</option>
                        <option value="MAMIS">MAMIS</option>
                        <option value="VETERANOS">VETERANOS</option>
                        <option value="SOCIO ACTIVO">SOCIO ACTIVO</option>
                    </select>
                </div>
                <button class="btn btn-primary w-100" id="btnGuardarSocio">GUARDAR EN BASE DE DATOS</button>
                <hr>
                <p class="small text-muted">Socios en sistema:</p>
                <ul id="listaSociosGuardados" class="list-group list-group-flush" style="max-height: 200px; overflow-y: auto;"></ul>
            </div>
        </div>
    </div>
</div>

<div id="modal-confirmacion" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:11000; justify-content:center; align-items:center; padding:20px;">
    <div style="background:white; padding:30px; border-radius:20px; width:100%; max-width:350px; text-align:center;">
        <h5 style="color:var(--primary); font-weight:bold;">SAN MARTÍN HOCKEY</h5>
        <p id="modal-mensaje" class="my-4"></p>
        <div class="d-flex gap-2">
            <button id="btn-cancelar" class="btn btn-light border flex-grow-1">Cancelar</button>
            <button id="btn-confirmar" class="btn btn-primary flex-grow-1">Aceptar</button>
        </div>
    </div>
</div>

<div id="areaRecibo">
    <div style="border: 3px solid #003366; padding: 20px; border-radius: 10px;">
        <h1 style="text-align:center;">SAN MARTÍN HOCKEY</h1>
        <hr>
        <p><strong>FOLIO:</strong> <span id="r-folio"></span></p>
        <p><strong>SOCIO:</strong> <span id="r-nombre"></span></p>
        <p><strong>CATEGORIA:</strong> <span id="r-categoria"></span></p>
        <p><strong>CONCEPTO:</strong> <span id="r-concepto"></span> (<span id="r-mes"></span>)</p>
        <h2 style="text-align:right;">TOTAL: $<span id="r-total"></span></h2>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="app.js"></script>
</body>
</html>